%global __jar_repack 0
Name: ovirt-engine-wildfly
Version: @VERSION@
Release: 1%{?dist}
Summary: WildFly Application Server for oVirt Engine
Group: Virtualization/Management
License: ASL 2.0
URL: http://jbossas.jboss.org
Source: @SRC@

BuildRequires: unzip
BuildRequires: chrpath

# Prevent breaking packages that require e.g. libapr-1.so
AutoReqProv: no

%description
WildFly Application Server for oVirt Engine.

%install
mkdir -p %{buildroot}%{_datadir}
unzip -d %{buildroot}%{_datadir} %{SOURCE0}
mv %{buildroot}%{_datadir}/wildfly-%{version}.@QUALIFIER@ %{buildroot}%{_datadir}/%{name}

# Remove the shared objects that aren't suitable for the architecture
# that the package is being built for:
function remove_shared_objects () {
  find \
      %{buildroot}%{_datadir}/%{name}/modules/system/layers/base \
      -depth \
      -type d \
      -name "linux-$1" \
      -exec rm -rf {} \;
}
%ifarch x86_64
remove_shared_objects i686
%endif
%ifarch %{ix86}
remove_shared_objects x86_64
%endif

# Delete the "rpath" of the remaining shared objects:
find \
    %{buildroot}%{_datadir}/%{name}/modules/system/layers/base \
    -type f \
    -name '*.so' \
    -exec chrpath --delete {} \;

%files
%{_datadir}

%changelog
* Mon Feb 22 2016 Martin Perina <mperina@redhat.com> - 10.0.0-1
- Update to upstream version 10.0.0.Final.

* Thu Jan 07 2016 Martin Perina <mperina@redhat.com> - 10.0.0-0.4
- Update to upstream version 10.0.0.CR5.

* Wed Nov 04 2015 Martin Perina <mperina@redhat.com> - 10.0.0-0.3
- Update to upstream version 10.0.0.CR4.

* Thu Sep 17 2015 Juan Hernandez <juan.hernandez@redhat.com> - 10.0.0-0.1
- Update to upstream version 10.0.0.

* Tue Feb 17 2015 Juan Hernandez <juan.hernandez@redhat.com> - 8.2.0-1
- Update to upstream version 8.2.0.

* Thu Jul 17 2014 Juan Hernandez <juan.hernandez@redhat.com> - 8.1.0-1
- Initial release based on existing jboss-as spec file.
